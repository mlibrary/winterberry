<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>HEB EPUB Generation</title>
</head>
<body><h1>HEB EPUB Generation</h1><section id="Introduction"><?Pub Dtl?><h2
>Introduction</h2><p>This document provides the details for the generation
of HEB EPUB books, including both fixed and flowable layout books.</p
><p>The root directory location for the HEB EPUB books is the following:</p
><p><strong><a name="ROOTDIR">ROOTDIR</a>= tang.umdl.umich.edu:/quod-prep/prep/a/acls/hebepub</strong
> </p><p>This location contains the following directories:</p><ul>
<li><strong>fixepub</strong> - directory contains the fixed layout
book specifics. See <a href="#Layouts">Layouts</a> for more information.</li>
<li><strong>flowepub</strong> - directory contains the flowable layout
book specifics. See <a href="#Layouts">Layouts</a>&#xa0;for more information. </li>
<li><strong>resources</strong> - directory contains the source for
resources used for generating a EPUB. See section <a href="#Resources"
>Resources</a> for more information.</li>
<li><strong>target</strong> - directory contains the files used to
automate the generation process. See section <a href="#Implementation"
>Implementation</a> for more information.</li>
</ul></section><section id="Layouts"><?Pub Dtl?><h2>Layouts</h2><p
>The process for generating a HEB EPUB archive differs based on the
layout of the book. Currently, each layout has its own directory within
the <a href="#ROOTDIR">ROOTDIR</a> location where the book source
resides and any specific resources needed to generate the book. Below
are the contents found within a layout directory:</p><ul>
<li><p><strong>books</strong> - this directory contains the books
for the specified layout. Within this directory, each book has a directory
with the book HEB ID as the name. See section <a
href="#HEB-Book-Source-Structure">HEB Book Source Structure</a> for
more information.</p></li>
<li><p><strong>dlxs</strong> - this directory contains the original
source DLXS XML files. For <strong>flowepub</strong>, the contents
is the list of XML files with the HEB ID as the name.</p><p>For <strong
>fixepub</strong>, this is a link to the directory&#xa0;<strong>tang.umdl.umich.edu:/n1/obj/h/e/b</strong
> and the contents consists of a list of directories, one for each
HEB book, with the name being the book HEB ID. Each book directory
contains the source DLXS XML file and all original page scans.</p
></li>
</ul></section><section id="Resources"><?Pub Dtl?><h2>Resources</h2
><p>The resources directory contains the source for the following
information used for generating a HEB EPUB:</p><ul>
<li><p><strong>aclsdb </strong>- directory containing information
provided by ACLS for HEB books. This information includes:</p><ul>
<li><p><strong><a name="copyholder">copyholder </a></strong> - if
a HEB book has copyright information, then this directory contains
a HTML file with the name of the book HEB ID that consists of a table
listing the copyright holder organizations and a URL contact for each.</p
></li>
<li><p><strong><a name="related_title">related_title</a></strong> -
if a HEB book has related titles, then this directory contains a HTML
file with the name of the book HEB ID that consists of a table listing
the related titles.</p></li>
<li><p><strong><a name="reviews">reviews</a></strong> - if a HEB book
has reviews, then this directory contains a HTML file with the name
of the book HEB ID that consists of a table listing the reviews.</p
></li>
<li><p><strong><a name="series">series </a></strong> - if a HEB book
has series designations, then this directory contains a HTML file
with the name of the book HEB ID that consists of a table listing
the designations.</p> </li>
<li><p><strong><a name="subject">subject</a></strong> - if a HEB book
has subject designations, then this directory contains a HTML file
with the name of the book HEB ID that consists of a table listing
the subjects.</p></li>
</ul></li>
<li><p><strong><a name="assets">assets</a></strong> - directory containing
all assets for all HEB books, including cover image, audio, video,
and PDF files.</p><p><strong>NOTE</strong>: this directory is a link
to the following directory:</p><p><strong>tang.umdl.umich.edu:/n1/web/a/acls/images</strong
></p></li>
<li><p><strong><a name="asset_links">asset_links</a></strong> - if
a HEB book currently has a Fulcrum monograph page with assets listed
on the Media tab, then this directory contains a CSV file with the
name of the book HEB ID that contains the information for each book
asset.</p></li>
<li><p><strong><a name="marc">marc</a></strong> - if a HEB book has
a MARC record, then this directory contains a XML file representation
of the record. The file name is the first 5 digits of the HEB ID.</p
></li>
</ul></section><section id="HEB-Book-Source-Structure"><?Pub Dtl?><h2
>HEB Book Source Structure</h2><p>The EPUB source for a HEB book can
be found in a directory at the following path:</p><p><strong><a
href="#ROOTDIR">ROOTDIR</a>/</strong><em>layout</em>/<em>hebxxxxx.xxxx.xxx</em
></p><p>where <em>layout </em>is either <strong>fixepub</strong> or <strong
>flowepub</strong> and <em>hebxxxxx.xxxx.xxx</em> is the HEB ID assigned
to the book. For example, the source for the fixed layout book with
ID <strong>heb04015.0001.001</strong> can be found in the following
directory:</p><p><strong><a href="#ROOTDIR">ROOTDIR</a>/fixepub/heb04015.0001.001</strong
></p><p>The source directory for the HEB book with the ID hebxxxxx.xxxx.xxx
has the following layout:</p><ul>
<li><p><strong><a name="epub_dir">epub</a></strong> - directory containing
the unzipped EPUB book structure, including:</p>             <ul>
<li><p><strong>mimetype</strong></p></li>
<li><p><strong>META-INF/{container,metadata}.xml</strong></p></li>
<li><p><strong><a name="METAINFSRC"></a>META-INF/src</strong> - this
directory contains the source XML files used to generate this EPUB,
including the original DLXS and TEI XML. The allows for the book source
to be contained within the EPUB archive itself. Below is a list of
the expected contents:</p><ul>
<li><p><strong><a name="heb_dlxs_xml">hebxxxxx.xxxx.xxx_dlxs.xml</a
></strong> - DLXS XML source for the book.</p></li>
<li><p><strong><a name="heb_dlxs_org_xml">hebxxxxx.xxxx.xxx_dlxs_org.xml</a
></strong> - original DLXS XML source for the book. This is present
only if it required modification before being processed.</p></li>
<li><p><strong><a name="heb_tei_xml">hebxxxxx.xxxx.xxx_tei.xml</a
></strong> - TEI XML source generated by transformation of the DLXS
XML source. This file is used to generate the EPUB archive.</p></li>
<li><p><strong><a name="assets_html">assets.html</a></strong> - HTML
table referenced by the TEI XML file that lists all assets associated
with this book, including cover images, book images, audio, video,
PDFs, etc. For each asset, a column exists indicating the following
concerning each asset:</p><ul>
<li><p>full path.</p></li>
<li><p>mime-type.</p></li>
<li><p>whether it should be included in the EPUB archive.</p></li>
<li><p>whether it should be listed in the monograph Media tab.</p
></li>
<li><p>whether it is a cover image.</p></li>
<li><p>whether is a hi-resolution version of the image (determined
by the -lg suffix on the file name).</p></li>
<li><p>width in pixels, if asset is an image.</p></li>
<li><p>height in pixels,&#xa0;if asset is an image.</p></li>
<li><p>title if asset has previously been uploaded to Fulcrum.&#xa0;Generated
from the contents of&#xa0;<a href="#asset_links">asset_links</a>..
                        </p></li>
<li><p>NOID if asset has previously been uploaded to Fulcrum.&#xa0;Generated
from the contents of&#xa0;<a href="#asset_links">asset_links</a>.
                        </p></li>
<li><p>URL link to asset page,&#xa0;if asset has previously been uploaded
to Fulcrum.&#xa0;Generated from the contents of&#xa0;<a
href="#asset_links">asset_links</a>.</p></li>
<li><p>embed code markup&#xa0;if asset has previously been uploaded
to Fulcrum. </p><p><strong>NOTE:</strong> for fixed layout books,
the page scans are not included in this list.</p></li>
</ul></li>
<li><p><strong><a name="copyholder_html">copyholder.html</a></strong
> - copy of <a href="#copyholder">copyholder</a>.</p></li>
<li><p><strong><a name="fonts_html">fonts.html</a></strong> - HTML
table referenced by the TEI XML file that lists all fonts to be included
within the EPUB archive.</p></li>
<li><p><strong><a name="images_html">images.html</a></strong> - HTML
table referenced by the TEI XML file that lists all images referenced
by the book. For each image, a column exists indicating the format,
width, and height. Useful for setting the viewport metadata within
a fixed layout page scan HTML file.</p></li>
<li><p><strong><a name="links_html">links.html</a></strong> -?.</p
></li>
<li><p><strong><a name="marc_xml">marc.xml</a></strong> - copy of <a
href="#marc">marc</a>.</p></li>
<li><p><strong><a name="related_html">related.html</a></strong> -
copy of <a href="#related_title">related_title</a>. If not empty,
then this file is uploaded to Fulcrum and used as the contents to
the monograph page Related Titles tab.</p></li>
<li><p><strong><a name="reviews_html">reviews.html</a></strong> -
copy of <a href="#reviews">reviews</a>. If not empty, then this file
is uploaded to Fulcrum and used as the contents to the monograph page
Reviews tab.</p></li>
<li><p><strong><a name="series_html">series.html</a></strong> - copy
of <a href="#series">series</a>.</p></li>
<li><p><strong><a name="stylesheets_html">stylesheets.html</a></strong
> - HTML table referenced by the TEI XML file that lists all CSS stylesheets
to be included within the EPUB archive.</p></li>
<li><p><strong><a name="subject_html">subject.html</a></strong> -
copy of <a href="#subject">subject</a>.</p></li>
</ul></li>
<li><p><strong><a name="OEBPS">OEBPS</a></strong> - contains the book
content.</p><ul>
<li><p><strong><a name="fonts_dir">fonts</a></strong>- directory containing
the book font files listed in the <a href="#fonts_html">fonts.html</a
> file. This directory is present only for <strong>flowepub</strong
>.</p></li>
<li><p><strong><a name="images_dir">images</a></strong>- directory
containing the images listed in the <a href="#images_html">images.html</a
> file. The book cover images reside here. For the fixed layout books,
the page scan images reside here. For&#xa0;<strong>flowepub</strong
>, all images referenced by the <a href="#heb_tei_xml">hebxxxxx.xxxx.xxx_tei.xml</a
> file reside here.</p></li>
<li><p><strong><a name="styles_dir">styles</a></strong>- directory
containing the CSS stylesheet files listed in the <a
href="#stylesheets_html">stylesheets.html</a> file.</p></li>
<li><p><strong><a name="xhtml_dir"></a>xhtml </strong>- directory
containing the HTML/XHTML files for this book.</p></li>
<li><p><strong>content_{fixed_ocr,fixed_scan,flow}.opf</strong> -
EPUB package file. For <strong>fixepub</strong>, there exists two
files, one for the page scan rendition (<strong>content_fixed_scan.opf</strong
>) and the second for the text OCR rendition (<strong>content_fixed_ocr.opf</strong
>). For <strong>flowepub</strong>, there is one file (<strong>content_flow.opf</strong
>).</p></li>
<li><p><strong>toc_{fixed_ocr,fixed_scan, flow}.xhtml</strong> - EPUB
TOC files. For <strong>fixepub</strong>, there exists two files, one
for the page scan rendition (<strong>toc_fixed_scan.xthml</strong
>) and the second for the text OCR rendition (<strong>toc_fixed_ocr.xhtml</strong
>). For <strong>flowepub</strong>, there is one file (<strong>toc_flow.xhtml</strong
>).</p></li>
<li><p><strong>page_list_{fixed_ocr,fixed_scan,flow}.xhtml</strong
> - EPUB page list files. For <strong>fixepub</strong>, there exists
two files, one for the page scan rendition (<strong>pagelist_fixed_scan.xhtml</strong
>) and the second for the text OCR rendition (<strong>pagelist_fixed_ocr.xhtml</strong
>). For <strong>flowepub</strong>, there is one file (<strong>pagelist_flow.xhtml</strong
>).</p></li>
<li><p><strong>chapter_list_{fixed_ocr,fixed_scan,flow}.xhtml</strong
> - EPUB chapter list files. For <strong>fixepub</strong>, there exists
two files, one for the page scan rendition (<strong>chapterlist_fixed_scan.xthml</strong
>) and the second for the text OCR rendition (<strong>chapterlist_fixed_ocr.xhtml</strong
>). For <strong>flowepub</strong>, there is one file (<strong>chapterlist_flow.xhtml</strong
>).</p></li>
</ul></li>
</ul></li>
<li><p><strong><a name="heb_epub">hebxxxxx.xxxx.xxx.epub</a></strong
> - archive of the <a href="#epub_dir">epub</a> directory described
above.</p></li>
<li><p><strong><a name="heb_metadata_csv">hebxxxxx.xxxx.xxx_metadata.csv</a
></strong> - CSV file the contains the metadata for this book, including
the monograph information, asset information, <a href="#reviews_html"
>reviews.html</a>, <a href="#related_html">related.html</a>, and the
cover image.</p></li>
<li><p><strong><a name="heb_zip">hebxxxxx.xxxx.xxx.zip </a></strong
> - zip file that can be used as a Fulcrum bundle for upload to create
a new monograph. The following may be included:</p><ul>
<li><p><strong>hebxxxxx.xxxx.xxx_metadata.csv</strong></p></li>
<li><p><strong>hebxxxxx.xxxx.xxx-lg.jpg</strong> - book cover image.</p
></li>
<li><p><strong>hebxxxxx.xxxx.xxx.epub</strong></p></li>
<li><p><a href="#related_html">related.html</a> - if not empty.</p
></li>
<li><p><a href="#reviews_html">reviews.html</a> - if not empty.</p
></li>
<li><p>Media assets &#xa0;- the book media assets listed in the&#xa0;<a
href="#assets_html">assets.html</a>.</p></li>
</ul></li>
<li><p><strong><a name="epubcheck_xml"></a>epubcheck.xml</strong> -
may exists as a result of an invocation of the check production. Contains
the output from <strong>epubcheck</strong>&#xa0;validation.</p></li>
</ul></section><section id="Process-Invocation"><h2>Process Invocation</h2
><p>The command for invoking any process is the bash script <em><a
href="#hebepub">hebepub</a></em> found within the <a href="#ROOTDIR"
>ROOTDIR</a>/target/bin directory. The syntax for this command is:</p
><p><a href="#hebepub">hebepub</a> <em>production [hebDir&#x2026;]</em
></p><ul>
<li><p><em>production</em></p>             <ul>
<li><p><em>bundle </em>- generates a <a
href="#Generate-Fulcrum-Monograph-Bundle-Archive">Process 4 - Generate
Fulcrum Monograph Bundle Archive</a>. </p></li>
<li><p><em>check</em> - performs <a href="#EPUB-Structure-Validation"
>Process 3 - EPUB Structure Validation</a>.</p></li>
<li><p><em>clobber</em> - removes HEB source directory files thus
allowing it to be re-generated. See <a href="#Clobber-Source-Files"
>Process 6 - Clobber Source Files</a>.</p></li>
<li><p><em>convert</em> - for fixepub, converts original HEB source
page scan files from TIF/JP2 to PNG.</p></li>
<li><p><em>epub</em> - generates the <a href="#Generate-EPUB-Archive"
>Process 2 - Generate EPUB Archive</a>.</p></li>
</ul></li>
<li><p><em>hebDir</em> = path to 1 or more HEB EPUB source directories.
If no directory is specified, then the current directory is assumed.
If the specified directory does not exist, then a directory will be
created.</p></li>
</ul><p>This script sets required environment variables and traverses
the list of specified HEB source directories, invoking a Rake task
specified by the production parameter on each. See <a href="#rakefile"
>rakefile</a> for the details.</p><p>Below are example invocations:</p
><ol>
<li><p>For the XML title <strong>hebxxxxx.xxxx.xxx</strong>, the following
commands will generate the book EPUB archive file:</p><p><em>cd /quod-prep/prep/a/acls/hebepub</em
></p><p><em>target/bin/<a href="#hebepub">hebepub</a> epub flowepub/books/hebxxxxx.xxxx.xxx</em
></p><p>The resulting EPUB archive file is stored at</p><p><strong
>flowepub/books/hebxxxxx.xxxx.xxx/hebxxxxx.xxxx.xxx.epub</strong>.</p
></li>
<li><p>For the backlist title <strong>hebxxxxx.xxxx.xxx</strong>,
the following commands will generate the book Fulcrum bundle file:</p
><p><em>cd /quod-prep/prep/a/acls/hebepub</em></p><p><em>target/bin/<a
href="#hebepub">hebepub</a> bundle &#xa0;fixepub/books/hebxxxxx.xxxx.xxx</em
></p><p>The resulting bundle file is stored at</p><p><strong>fixepub/books/hebxxxxx.xxxx.xxx/hebxxxxx.xxxx.xxx.zip</strong
>.</p>          </li>
<li>             <p>The following commands will rebuild the bundle
file for backlist title <strong>hebxxxxx.xxxx.xxx</strong>:</p><p
><em>cd /quod-prep/prep/a/acls/hebepub</em></p><p><em>target/bin/<a
href="#hebepub">hebepub</a> clobber fixepub/books/hebxxxxx.xxxx.xxx</em
></p><p><em>target/bin/<a href="#hebepub">hebepub</a> bundle &#xa0;fixepub/books/hebxxxxx.xxxx.xxx</em
></p></li>
<li><p>The following commands will invoke <strong>epubcheck</strong
> on the specified EPUB source directory:</p><p><em>cd /quod-prep/prep/a/acls/hebepub</em
></p><p><em>target/bin/<a href="#hebepub">hebepub</a> check &#xa0;fixepub/books/hebxxxxx.xxxx.xxx</em
></p><p>The output from epubcheck is stored in the file</p><p><strong
>fixepub/books/hebxxxxx.xxxx.xxx/<a href="#epubcheck_xml">epubcheck.xml</a
></strong></p>          </li>
<li><p>The following commands will convert page scan TIF images to
PNG for backlist title <strong>hebxxxxx.xxxx.xxx</strong>:</p><p><em
>cd /quod-prep/prep/a/acls/hebepub</em></p><p><em>target/bin/<a
href="#hebepub">hebepub</a> convert &#xa0;fixepub/books/hebxxxxx.xxxx.xxx</em
></p><p>The new PNG files are stored in the directory:</p><p><strong
>fixepub/books/hebxxxxx.xxxx.xxx/epub/OEBPS/images</strong></p></li>
</ol><p>The following sections describe the steps necessary to perform
the HEB EPUB processes.</p><section id="Convert-Page-Scans"><?Pub Dtl?><h3
>Process 1 - Convert Page Scans (fixepub only)</h3><p>For <strong
>fixepub</strong> books, original page scan files for the book are
expected to reside in the following directory:</p><p><strong><a
href="#ROOTDIR">ROOTDIR</a>/lfixepub/dlxs/hebxxxxx.xxxx.xxx</strong
></p><p>where <strong>hebxxxxx.xxxx.xxx</strong> is the HEB ID assigned
to the book. The file format is expected to be either TIF or JP2.
The EPUB specification does not support TIF, so it is necessary to
convert the original scans to PNG.</p><p>The conversion can be done
by invoking the following commands:</p><p><em>cd /quod-prep/prep/a/acls/hebepub</em
></p><p><em>target/bin/<a href="#hebepub">hebepub</a> convert layout/hebxxxxx.xxxx.xxx</em
></p><p>The new PNG files are stored in the <a href="#images_dir"
>images</a> directory within the <strong>hebxxxxx.xxxx.xxx</strong
> book source directory. </p></section><section
id="Generate-EPUB-Archive"><?Pub Dtl?><h3>Process 2 - Generate EPUB
Archive</h3><p>Below are the process steps necessary to generate the
HEB book EPUB archive. The following commands can be used to invoke
this process and generate a HEB EPUB for the book with the ID <strong
>hebxxxxx.xxxx.xxx</strong>:</p><p><em>cd /quod-prep/prep/a/acls/hebepub</em
></p><p><em>target/bin/<a href="#hebepub">hebepub</a>  epub layout/hebxxxxx.xxxx.xxx</em
></p><section id="Copy-DLXS-XML-Source"><?Pub Dtl?><h4>Step 2.1 -
Copy DLXS XML Source</h4><p>The book DLXS XML source is expected to
be found at the path listed in the table below and copied to path <a
href="#heb_dlxs_xml">hebxxxxx.xxxx.xxx_dlxs.xml</a>.</p><table
class="wrapped" style="margin-left: 30.0px;">
<colgroup>
<col/>
<col/></colgroup>
<tbody style="margin-left: 30.0px;">
<tr style="margin-left: 30.0px;">
<td style="margin-left: 30.0px;"><p><strong>Layout</strong></p></td>
<td style="margin-left: 30.0px;"><p><strong>Source Path</strong></p
></td>
</tr>
<tr style="margin-left: 30.0px;">
<td style="margin-left: 30.0px;"><p>fixepub</p></td>
<td style="margin-left: 30.0px;"><p><strong><a href="#ROOTDIR">ROOTDIR</a
>/fixepub/dlxs/hebxxxxx.xxxx.xxx/hebxxxxx.xxxx.xxx.xml</strong></p
></td>
</tr>
<tr style="margin-left: 30.0px;">
<td style="margin-left: 30.0px;"><p>flowepub</p></td>
<td style="margin-left: 30.0px;"><p><strong><a href="#ROOTDIR">ROOTDIR</a
>/flowepub/dlxs/hebxxxxx.xxxx.xxx.xml</strong></p></td>
</tr>
</tbody>
</table></section><section id="Copy-Resource-Files"><?Pub Dtl?><h4
>Step 2.2 - Copy Resource Files</h4><p>The following resources are
copied from their source paths into the <a href="#METAINFSRC">METAINFSRC</a
>&#xa0;directory and referenced by the <a href="#heb_tei_xml">hebxxxxx.xxxx.xxx_tei.xml</a
> file: </p><table class="wrapped" style="margin-left: 30.0px;">
<colgroup>
<col style="width: 154.0px;"/>
<col style="width: 447.0px;"/></colgroup>
<tbody style="margin-left: 30.0px;">
<tr style="margin-left: 30.0px;">
<th style="margin-left: 30.0px;"><p><strong>Resource</strong></p></th>
<td style="margin-left: 30.0px;"><p><strong>Source Paths</strong></p
></td>
</tr>
<tr style="margin-left: 30.0px;">
<th style="margin-left: 30.0px;"><p><a href="#marc_xml">marc.xml</a
></p></th>
<td style="margin-left: 30.0px;"><p><strong><a href="#ROOTDIR">ROOTDIR</a
>/resources/marc/hebxxxxx.xml</strong></p></td>
</tr>
<tr style="margin-left: 30.0px;">
<th style="margin-left: 30.0px;"><p><a href="#copyholder_html">copyholder.html</a
></p></th>
<td style="margin-left: 30.0px;"><p><strong><a href="#ROOTDIR">ROOTDIR</a
>/resources/aclsdb/copyholder/hebxxxxx.xxxx.xxx.xml</strong></p></td>
</tr>
<tr style="margin-left: 30.0px;">
<th style="margin-left: 30.0px;"><p><a href="#related_html">related.html</a
></p></th>
<td style="margin-left: 30.0px;"><p><strong><a href="#ROOTDIR">ROOTDIR</a
>/resources/aclsdb/related_title/hebxxxxx.xxxx.xxx.xml</strong></p
></td>
</tr>
<tr style="margin-left: 30.0px;">
<th style="margin-left: 30.0px;"><p><a href="#reviews_html">reviews.html</a
></p></th>
<td style="margin-left: 30.0px;"><p><strong><a href="#ROOTDIR">ROOTDIR</a
>/resources/aclsdb/reviews/hebxxxxx.xxxx.xxx.xml</strong></p></td>
</tr>
<tr style="margin-left: 30.0px;">
<th style="margin-left: 30.0px;"><p><a href="#series_html">series.html</a
></p></th>
<td style="margin-left: 30.0px;"><p><strong><a href="#ROOTDIR">ROOTDIR</a
>/resources/aclsdb/series/hebxxxxx.xxxx.xxx.xml</strong></p></td>
</tr>
<tr style="margin-left: 30.0px;">
<th style="margin-left: 30.0px;"><p><a href="#subject_html">subject.html</a
></p></th>
<td style="margin-left: 30.0px;"><p><strong><a href="#ROOTDIR">ROOTDIR</a
>/resources/aclsdb/subject/hebxxxxx.xxxx.xxx.xml</strong></p></td>
</tr>
</tbody>
</table></section><section id="Copy-Font-Files"><?Pub Dtl?><h4>Step
2.3 - Copy Font Files (flowepub only)</h4><p>The font files are found
in the directory </p><p><strong><a href="#ROOTDIR">ROOTDIR</a>/flowepub/fonts</strong
></p><p>and copied into the <a href="#fonts_dir">fonts</a> directory.
The <a href="#fonts_html">fonts.html</a> file is generated during
this step. For <strong>fixepub</strong>, currently there are no fonts
to include. So, this file is empty.</p></section><section
id="Copy-Stylesheet-Files"><?Pub Dtl?><h4>Step 2.4 - Copy Stylesheet
Files</h4><p>The CSS stylesheet file(s) are found in the directory </p
><p><strong><a href="#ROOTDIR">ROOTDIR</a></strong>/<em>layout</em
>/<strong>styles</strong></p><p>where <em>layout</em> is either <strong
>fixepub </strong>or <strong>flowepub</strong> and are copied into
the <a href="#styles_dir">styles</a> directory. The <a
href="#stylesheets_html">stylesheets.html</a> file is generated during
this step.</p></section><section id="Determine-Book-Assets"><?Pub Dtl?><h4
>Step 2.5 - Determine Book Assets</h4><p>Assets include book cover
image/audio/video/PDF/etc files. These files use the book HEB ID as
the prefix for the filename and are expected to reside in the directory:</p
><p><strong><a href="#ROOTDIR">ROOTDIR</a>/resources/assets</strong
></p><p>No files are copied during this step. The <a href="#assets_html"
>assets.html</a> file is generated.</p></section><section
id="Generate-TEI-XML-File"><?Pub Dtl?><h4>Step 2.6 - Generate TEI
XML File</h4><p>Transform the DLXS XML file <a href="#heb_dlxs_xml"
>hebxxxxx.xxxx.xxx_dlxs.xml</a> to the TEI XML file <a
href="#heb_tei_xml">hebxxxxx.xxxx.xxx_tei.xml</a> using the XSLT stylesheet <a
href="#hebdlxs2tei_xsl">hebdlxs2tei.xsl</a>.</p></section><section
id="Copy-Book-Cover-Images"><?Pub Dtl?><h4>Step 2.7 - Copy Book Cover
Image(s)</h4><p>The cover image(s) are located at the path:</p><p
><strong><a href="#ROOTDIR">ROOTDIR</a>/resources/assets/hebxxxxx.xxxx.xxx.jpg</strong
></p><p><strong><a href="#ROOTDIR">ROOTDIR</a>/resources/assets/hebxxxxx.xxxx.xxx-lg.jpg</strong
> (higher resolution, may not be present)</p><p>and copied in the <a
href="#images_dir">images</a> directory.</p></section><section
id="Determine-Image-Dimensions"><?Pub Dtl?><h4>Step 2.8 - Determine
Image Dimensions (fixepub only)</h4><p>For <strong>fixepub</strong
> only, all images found in the <a href="#images_dir">images</a> directory,
including cover images and page scan image files (see <a
href="#Convert-Page-Scans">Process 1 - Convert Page Scans (fixepub
only)</a>) are used as input for generating the <a href="#images_html"
>images.html</a> file.</p></section><section
id="Generate-EPUB-Structure"><?Pub Dtl?><h4>Step 2.9 - Generate EPUB
Structure</h4><p>The TEI XML file <a href="#heb_tei_xml">hebxxxxx.xxxx.xxx_tei.xml</a
> contains references to the resources (<a href="#marc_xml">marc.xml</a
>, <a href="#copyholder_html">copyholder.html</a>, <a
href="#related_html">related.html</a>, <a href="#reviews_html">reviews.html</a
>, <a href="#series_html">series.html</a>, <a href="#subject_html"
>subject.html</a>), fonts (<a href="#fonts_html">fonts.html</a>),
CSS stylesheets (<a href="#stylesheets_html">stylesheets.html</a>),
and book assets (<a href="#assets_html">assets.html</a>). It is used
as the input to a XSLT transformation to produce the EPUB book content
found in the <a href="#OEBPS">OEBPS</a> directory. The XSLT stylesheet <a
href="#hebtei2fixepub_xsl">hebtei2fixepub.xsl</a> (fixepub) and <a
href="#hebtei2flowepub_xsl">hebtei2flowepub.xsl</a> (flowepub) are
used for the transformation.</p></section><section
id="Copy-Image-Files-Determine-Image-Dimensions"><?Pub Dtl?><h4>Step
2.10 - Copy Image Files / Determine Image Dimensions (flowepub only)</h4
><p>For <strong>flowepub</strong> only, all images referenced by the
TEI XML file <a href="#heb_tei_xml">hebxxxxx.xxxx.xxx_tei.xml</a> are
copied to the <a href="#images_dir">images</a> directory. Then all
images found in the <a href="#images_dir">images</a> directory, including
cover images, are used as input for generating the <a
href="#images_html">images.html</a> file.</p></section><section
id="Zip-EPUB-Structure"><?Pub Dtl?><h4>Step 2.11 - Zip EPUB Structure</h4
><p>The <a href="#heb_epub">hebxxxxx.xxxx.xxx.epub</a> file is generated
by zipping the contents of the <a href="#epub_dir">epub</a> directory.</p
></section></section><section id="EPUB-Structure-Validation"><?Pub Dtl?><h3
>Process 3 - EPUB Structure Validation</h3><p>Any HEB EPUB directory
can be validated by invoking the following commands:</p><p><em>cd
/quod-prep/prep/a/acls/hebepub</em></p><p><em>target/bin/<a
href="#hebepub">hebepub</a> check layout/books/hebxxxxx.xxxx.xxx</em
></p><p>where layout is either <strong>fixepub</strong> or <strong
>flowepub</strong>. The results can be found in the file</p><p><strong
><a href="#ROOTDIR">ROOTDIR</a></strong><em>/layout</em>/books/hebxxxxx.xxxx.xxx/<a
href="#epubcheck_xml">epubcheck.xml</a></p></section><section
id="Generate-Fulcrum-Monograph-Bundle-Archive"><?Pub Dtl?><h3>Process
4 - Generate Fulcrum Monograph Bundle Archive</h3><p>To create a new
monograph for a HEB EPUB, the <a href="#heb_zip">hebxxxxx.xxxx.xxx.zip</a
> may be generated by invoking the following commands:</p><p><em>cd
/quod-prep/prep/a/acls/hebepub</em></p><p><em> target/bin/<a
href="#hebepub">hebepub</a> bundle layout/hebxxxxx.xxxx.xxx</em></p
><p>where <em>layout</em> is either <strong>fixepub</strong> or <strong
>flowepub</strong>.&#xa0;Below are the process steps for generating
the bundle. This process may invoke <a href="#Generate-EPUB-Archive"
>Process 2 - Generate EPUB Archive</a> if the <a href="#heb_epub"
>hebxxxxx.xxxx.xxx.epub</a> has not been previously generated.</p
><section id="Generate-Monograph-Metadata-CSV"><h4>Step 4.1 - Generate
Monograph Metadata CSV</h4><p>The TEI XML file <a href="#heb_tei_xml"
>hebxxxxx.xxxx.xxx_tei.xml</a> is used as the input to a XSLT transformation
to produce the monograph metadata file <a href="#heb_metadata_csv"
>hebxxxxx.xxxx.xxx_metadata.csv</a>. The XSLT stylesheet <a
href="#hebtei2meta_xsl">hebtei2meta.xsl</a> is used for the transformation.</p
></section><section id="Determine-Media-Assets"><?Pub Dtl?><h4>Step
4.2 - Determine Media Assets</h4><p>The <a href="#assets_html">assets.html</a
>&#xa0;file is used to determine the assets that are to be uploaded
to Fulcrum and listed on the monograph Media tab.</p></section><section
id="Zip-Monograph-Bundle"><?Pub Dtl?><h4>Step 4.3 - Zip Monograph
Bundle</h4><p>The <a href="#heb_zip">hebxxxxx.xxxx.xxx.zip</a> can
be generated as the necessary files have been generated.</p></section
></section><section id="Add-Asset-Links"><?Pub Dtl?><h3>Process 5
- Add Asset Links</h3><p>Links to existing Fulcrum Media asset pages
may be added to an EPUB by performing the following steps:</p><ol>
<li><p>Download the asset CSV file from the Fulcrum monograph page.</p
></li>
<li><p>Rename the CSV using HEB ID, <strong>hebxxxxx.xxxx.xxx.csv</strong
>, and store it in the <strong><a href="#ROOTDIR">ROOTDIR</a>/resources/asset_links</strong
> directory.</p></li>
<li><p>Invoke the commands in the section <a
href="#Generate-EPUB-Archive">Process 2 - Generate EPUB Archive</a
> to regenerate the EPUB archive</p></li>
<li><p>Replace or re-version the EPUB archive file asset on the Fulcrum
monograph page.</p></li>
</ol></section><section id="Clobber-Source-Files"><?Pub Dtl?><h3>Process
6 - Clobber Source Files</h3><p>To re-generate either a HEB EPUB or
Fulcrum bundle, invoke the following commands:</p><p><em>cd /quod-prep/prep/a/acls/hebepub</em
></p><p><em>target/bin/<a href="#hebepub">hebepub</a> clobber layout/hebxxxxx.xxxx.xxx</em
></p><p> This removes the necessary files to allow the HEB book source
directory to be rebuilt from scratch. This removes all files except
the following:</p><ul>
<li><p><a href="#heb_dlxs_xml">hebxxxxx.xxxx.xxx_dlxs.xml</a>&#xa0;-
this file may have been modified by hand to generate this book. So
this file is not removed.</p></li>
<li><p><a href="#heb_dlxs_org_xml">hebxxxxx.xxxx.xxx_dlxs_org.xml</a
>&#xa0;- if present, preserve the original DLXS XML source.</p></li>
</ul><p>For <strong>fixepub</strong>, the above files are not removed
and also the following is not removed:</p><ul>
<li> <p><a href="#images_dir">images</a> directory. Since often TIF
files have been converted to PNG and this process can be time consuming,
the page scans are not removed.</p></li>
</ul></section></section><section id="Implementation"><?Pub Dtl?><h3
>Implementation</h3><p>Below is a description of the <strong><a
href="#ROOTDIR">ROOTDIR</a>/target</strong> directory and the files
contained within:</p><ul>
<li><p><strong>bin</strong> - contains bash shell script for invoking
the genertion process.</p><ul>
<li><p><em><a name="hebepub">hebepub</a></em> - script for invoking
the epub/bundle generation process. The script iterates over the list
specified HEB directories and invokes a series of <strong>rake</strong
> tasks on each. It also sets a few environment specific variables
(development or production) used by the <strong>rake</strong> tasks.
See the script for more information.</p></li>
</ul></li>
<li><p><strong>layouts</strong> - contains files specific to a layout.</p
><ul>
<li><strong>fixepub</strong> - contains files specific to the fixed
page layout.<ul>
<li><strong>styles</strong> -&#xa0;directory containing the CSS stylesheets
to be included in the&#xa0;<a href="#styles_dir">styles</a>&#xa0;directory
of a HEB EPUB archive.</li>
</ul></li>
<li> <strong>flowepub</strong> -&#xa0;contains files specific to the
flowable page layout.<ul>
<li><p><strong>fonts</strong> - directory containing the fonts to
be included in the&#xa0;<a href="#fonts_dir">fonts</a>&#xa0;directory
of a HEB EPUB archive.</p></li>
<li><p><strong>styles</strong> - directory containing the CSS stylesheets
to be included in the&#xa0;<a href="#styles_dir">styles</a>&#xa0;directory
of a HEB EPUB archive.</p></li>
</ul></li>
</ul></li>
<li><p><strong>lib</strong> - contains files to support the above
described scripts.</p><ul>
<li><p><strong>jars </strong>- directory contains the following Java
jar files:</p><ul>
<li> <p><strong>epubcheck-jar-with-dependencies.jar</strong> - epubcheck
jar file from w3c/epubcheck GitHub. provides support for the <em><a
href="#hebepub">hebepub</a>check</em> production.</p></li>
<li><p><strong>hebimg-jar-with-dependencies.jar</strong> - &#xa0;provides
support for the <em><a href="#hebepub">hebepub</a> convert</em> production.
Includes support for image formats except jp2.</p></li>
<li><p><strong>hebimgjp2-jar-with-dependencies.jar</strong> - &#xa0;provides
support for the <em><a href="#hebepub">hebepub</a> convert</em> production.
Support for image formats except tif.</p></li>
<li><p><strong>hebxslt-jar-with-dependencies.jar</strong> - provides
support for the <em><a href="#hebepub">hebepub</a> epub | bundle </em
>productions. Invokes a XSLT 3.0 processor.</p></li>
</ul></li>
<li><p><strong>rake</strong>&#xa0;- directory contains the following
Ruby and Rake task files:</p><ul>
<li><p><strong><a name="rakefile">rakefile</a></strong> - top level
Rake task file that implements the process productions described in
section <a href="#Process-Invocation">Process Invocation</a>.</p></li>
<li><p><strong>acls.rake</strong> - Rake task file imported by <a
href="#rakefile">rakefile</a> that implements the dependencies for
the ACLS provided files, including <a href="#copyholder_html">copyholder.html</a
>, <a href="#related_html">related.html</a>, <a href="#reviews_html"
>reviews.html</a>, <a href="#series_html">series.html</a>, and <a
href="#subject_html">subject.html</a>.</p></li>
<li><p><strong>assets.rake</strong> - Rake task file imported by <a
href="#rakefile">rakefile</a> that implements the dependencies for
the <a href="#assets_html">assets.html</a> file.</p></li>
<li><p><strong>fonts.rake</strong> - Rake task file imported by <a
href="#rakefile">rakefile</a> that implements the dependencies for
the <a href="#fonts_html">fonts.html</a> file.</p></li>
<li><p><strong>Gemfile</strong> - Gem file listed required gems.</p
></li>
<li><p><strong>styles.rake</strong> - Rake task file imported by <a
href="#rakefile">rakefile</a> that implements the dependencies for
the <a href="#stylesheets_html">stylesheets.html</a> file.</p></li>
<li><p><strong>common.rb</strong> - sets the value of path variables
that are shared by the rest of the Ruby and Rake task files, such
paths to the EPUB source files and the target directory files.</p
></li>
<li><p><strong>AssetListener.rb</strong> - Ruby class file implementing
a listener used during parsing of the <a href="#assets_html">assets.html</a
> and <a href="#links_html">links.html</a> files.</p></li>
<li><p><strong>EmptyListener.rb</strong> -&#xa0;Ruby class file implementing
a listener used for parsing&#xa0;<a href="#related_html">related.html</a
>&#xa0;and&#xa0;<a href="#reviews_html">reviews.html</a>&#xa0;to determine
if they are empty. If so, these files are not included in the Fulcrum
bundle <a href="#heb_zip">hebxxxxx.xxxx.xxx.zip</a></p></li>
</ul></li>
<li><p><strong>xsl </strong>- directory contains the following XSLT
files:</p><ul>
<li><p><strong><a name="hebdlxs2tei_xsl">hebdlxs2tei.xsl</a></strong
> - transforms DLXS XML file <a href="#heb_dlxs_xml">hebxxxxx.xxxx.xxx_dlxs.xml</a
> to TEI XML file <a href="#heb_tei_xml">hebxxxxx.xxxx.xxx_tei.xml</a
>. See process <a href="#Generate-TEI-XML-File">Step 2.6 - Generate
TEI XML File</a>.</p></li>
<li><p><strong><a name="hebtei2fixepub_xsl">hebtei2fixepub.xsl</a
></strong> - transforms TEI XML file <a href="#heb_tei_xml">hebxxxxx.xxxx.xxx_tei.xml</a
> to fixed layout <a href="#HEB-Book-Source-Structure">HEB Book Source
Structure</a>. See process <a href="#Generate-EPUB-Structure">Step
2.9 - Generate EPUB Structure</a>.</p></li>
<li><p><strong><a name="hebtei2flowepub_xsl">hebtei2flowepub.xsl</a
></strong> - transforms TEI XML file <a href="#heb_tei_xml">hebxxxxx.xxxx.xxx_tei.xml</a
> to flowable layout <a href="#HEB-Book-Source-Structure">HEB Book
Source Structure</a>. See process <a href="#Generate-EPUB-Structure"
>Step 2.9 - Generate EPUB Structure</a>.</p></li>
<li><p><strong><a name="hebtei2meta_xsl">hebtei2meta.xsl</a></strong
> - transforms TEI XML file <a href="#heb_tei_xml">hebxxxxx.xxxx.xxx_tei.xml</a
> to the Fulcrum monograph metadata CSV file <a href="#heb_metadata_csv"
>hebxxxxx.xxxx.xxx_metadata.csv</a>.</p></li>
<li><p><strong>heblib.xsl</strong> - shared XSL file that sets constants
used by the above XSLT files.</p></li>
<li><p><strong>heblibtei.xsl</strong> - shared XSL file that sets
variables used by the XSLT files <a href="#hebtei2fixepub_xsl">hebtei2fixepub.xsl</a
>, <a href="#hebtei2flowepub_xsl">hebtei2flowepub.xsl</a>, and <a
href="#hebtei2meta_xsl">hebtei2meta.xsl</a>.</p></li>
<li><p><strong>hebtei2epub.xsl</strong> - shared XSL file that sets
variables and defines templates used by the XSLT files <a
href="#hebtei2fixepub_xsl">hebtei2fixepub.xsl</a> and <a
href="#hebtei2flowepub_xsl">hebtei2flowepub.xsl</a>.</p></li>
</ul></li>
</ul></li>
</ul></section></body>
</html>
